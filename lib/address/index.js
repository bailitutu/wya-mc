"use strict";var _extends=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},_utils=require("../utils/utils"),_data5=require("./data"),_data6=_interopRequireDefault(_data5);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _toConsumableArray(e){if(Array.isArray(e)){for(var a=0,t=Array(e.length);a<e.length;a++)t[a]=e[a];return t}return Array.from(e)}var VALUE_TYPE=["code","name"];Component({properties:{value:{type:Array,value:[]},valueType:{type:String,value:"code"},customer:{type:Boolean,value:!1},url:{type:String,value:""}},attached:function(){var e=this.data.url;e?this._loadData(e):this._initData(_data6.default)},data:{addressRange:[],oldAddressRange:[],provinceData:[],cityData:{},districtData:{},selectedIndexArray:[0,0,0]},methods:{_loadData:function(e){(0,_utils.getItem)("areaData")||""||wx.request({url:e,method:"GET",success:function(e){this._initData(e.data)},fail:function(e){console.log(e)}})},_initData:function(e){var a=this.data,t=a.value,n=a.valueType;if(-1===VALUE_TYPE.indexOf[n])throw new Error("address组件valueType必须是code和name中的一个");var i=this._formatAddress(e),r=i.provinceData,o=i.cityData,d=i.districtData,s=this._findIndex(r,t[0]||"110000",n),c=r[s].national_code,l=r[s].region_name,_=o[c],u=this._findIndex(_,t[1]||"110100",n),h=_[u].national_code,g=_[u].region_name,v=d[h],y=this._findIndex(v,t[2]||"110101",n),f=v[y].national_code,m=v[y].region_name;this.setData({provinceData:r,cityData:o,districtData:d,addressRange:[r,_,v],oldAddressRange:[r,_,v]}),3===t.length&&this._initItem({province_code:c,province_name:l,city_code:h,city_name:g,district_code:f,district_name:m},[s,u,y])},_formatAddress:function(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],a=[],t={},n={},i=0;i<e.length;i++){var r;r={national_code:e[i].national_code,region_name:e[i].region_name,parent_id:e[i].parent_id},a.push(r),e[i].children&&0<e[i].children.length&&(t[e[i].national_code]=this._getCityData(e[i].children).cityData,n=_extends({},n,this._getCityData(e[i].children).districtData))}return{provinceData:a,cityData:t,districtData:n}},_getCityData:function(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],a=[],t={},n=0;n<e.length;n++){var i;i={national_code:e[n].national_code,region_name:e[n].region_name,parent_id:e[n].parent_id},a.push(i),e[n].children&&0<e[n].children.length&&(t[e[n].national_code]=this._getDistrictData(e[n].children))}return{cityData:a,districtData:t}},_getDistrictData:function(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],a=[],t=0;t<e.length;t++){var n;n={national_code:e[t].national_code,region_name:e[t].region_name,parent_id:e[t].parent_id},a.push(n)}return a},_findIndex:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],a=arguments[1],t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"code";return"code"==t?e.findIndex(function(e){return e.national_code===a}):"name"==t?e.findIndex(function(e){return e.region_name===a}):void 0},_initItem:function(e,a){this.setData({selectedIndexArray:[].concat(_toConsumableArray(a)),value:[].concat(_toConsumableArray(a))}),this.triggerEvent("ready",{value:_extends({},e)})},handleClose:function(){this.triggerEvent("close",{})},handleChange:function(e){var a=this.data,t=a.selectedIndexArray,n=a.addressRange;this.setData({value:t,oldAddressRange:n}),this.handleClose(),this.triggerEvent("ok",{value:{province_code:n[0][t[0]].national_code,province_name:n[0][t[0]].region_name,city_code:n[1][t[1]].national_code,city_name:n[1][t[1]].region_name,district_code:n[2][t[2]].national_code,district_name:n[2][t[2]].region_name}})},handleCancel:function(e){var a=this.data,t=a.value,n=(a.addressRange,a.oldAddressRange);this.setData({selectedIndexArray:t,addressRange:n}),this.handleClose(),this.triggerEvent("cancel",{})},handleColumnChange:function(e){var a=this.data,t=a.provinceData,n=a.cityData,i=a.districtData,r=(a.selected,a.addressRange),o=a.selectedIndexArray,d=e.detail,s=d.column,c=void 0===s?0:s,l=d.value,_=void 0===l?0:l,u=[].concat(_toConsumableArray(o));switch(c){case 0:var h=n[t[_].national_code],g=i[h[0].national_code];u[0]=_,u[1]=0,u[2]=0,this.setData({addressRange:[t,h,g],selectedIndexArray:[].concat(_toConsumableArray(u))});break;case 1:var v=i[r[1][_].national_code];u[1]=_,u[2]=0,this.setData({addressRange:[t,r[1],v],selectedIndexArray:[].concat(_toConsumableArray(u))});break;case 2:u[2]=_,this.setData({selectedIndexArray:[].concat(_toConsumableArray(u))})}}}});