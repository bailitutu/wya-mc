"use strict";var _extends=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},_utils=require("../utils/utils"),_data5=require("./data"),_data6=_interopRequireDefault(_data5);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _toConsumableArray(e){if(Array.isArray(e)){for(var a=0,t=Array(e.length);a<e.length;a++)t[a]=e[a];return t}return Array.from(e)}var VALUE_TYPE=["code","name"];Component({properties:{defaultValue:{type:Array,value:[],observer:function(e,a){this.setData({defaultValue:e});var t=(0,_utils.getItem)("areaData")||"";this._initData(t||_data6.default)}},valueType:{type:String,value:"code"},customer:{type:Boolean,value:!1},url:{type:String,value:""}},attached:function(){var e=this.data.url;e?this._loadData(e):this._initData(_data6.default)},data:{addressRange:[],oldAddressRange:[],provinceData:[],cityData:{},districtData:{},selectedIndexArray:[0,0,0],value:[]},methods:{_loadData:function(e){(0,_utils.getItem)("areaData")||""||wx.request({url:e,method:"GET",success:function(e){this.setItem("areaData",e.data),this._initData(e.data)},fail:function(e){console.log(e)}})},_initData:function(e){var a=this.data,t=a.defaultValue,n=a.valueType,i=this._formatAddress(e),r=i.provinceData,d=i.cityData,o=i.districtData;if(-1===VALUE_TYPE.indexOf[n])throw new Error("address组件valueType必须是code和name中的一个");var s="code"===n?"110000":"北京市",c="code"===n?"110100":"北京市辖区",l="code"===n?"110101":"东城区",_=this._findIndex(r,t[0]||s,n),u=r[_].national_code,h=r[_].region_name,g=d[u],v=this._findIndex(g,t[1]||c,n),f=g[v].national_code,D=g[v].region_name,y=o[f],m=this._findIndex(y,t[2]||l,n),p=y[m].national_code,A=y[m].region_name;this.setData({provinceData:r,cityData:d,districtData:o,addressRange:[r,g,y],oldAddressRange:[r,g,y]}),3===t.length&&this._initItem({province_code:u,province_name:h,city_code:f,city_name:D,district_code:p,district_name:A},[_,v,m])},_formatAddress:function(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],a=[],t={},n={},i=0;i<e.length;i++){var r;r={national_code:e[i].national_code,region_name:e[i].region_name,parent_id:e[i].parent_id},a.push(r),e[i].children&&0<e[i].children.length&&(t[e[i].national_code]=this._getCityData(e[i].children).cityData,n=_extends({},n,this._getCityData(e[i].children).districtData))}return{provinceData:a,cityData:t,districtData:n}},_getCityData:function(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],a=[],t={},n=0;n<e.length;n++){var i;i={national_code:e[n].national_code,region_name:e[n].region_name,parent_id:e[n].parent_id},a.push(i),e[n].children&&0<e[n].children.length&&(t[e[n].national_code]=this._getDistrictData(e[n].children))}return{cityData:a,districtData:t}},_getDistrictData:function(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],a=[],t=0;t<e.length;t++){var n;n={national_code:e[t].national_code,region_name:e[t].region_name,parent_id:e[t].parent_id},a.push(n)}return a},_findIndex:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],a=arguments[1],t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"code";return"code"==t?e.findIndex(function(e){return e.national_code===a}):"name"==t?e.findIndex(function(e){return e.region_name===a}):void 0},_initItem:function(e,a){this.setData({selectedIndexArray:[].concat(_toConsumableArray(a)),value:[].concat(_toConsumableArray(a))}),this.triggerEvent("ready",{value:_extends({},e)})},handleClose:function(){this.triggerEvent("close",{})},handleChange:function(e){var a=this.data,t=a.selectedIndexArray,n=a.addressRange;this.setData({value:t,oldAddressRange:n}),this.handleClose(),this.triggerEvent("ok",{value:{province_code:n[0][t[0]].national_code,province_name:n[0][t[0]].region_name,city_code:n[1][t[1]].national_code,city_name:n[1][t[1]].region_name,district_code:n[2][t[2]].national_code,district_name:n[2][t[2]].region_name}})},handleCancel:function(e){var a=this.data,t=a.value,n=(a.addressRange,a.oldAddressRange);this.setData({selectedIndexArray:t,addressRange:n}),this.handleClose(),this.triggerEvent("cancel",{})},handleColumnChange:function(e){var a=this.data,t=a.provinceData,n=a.cityData,i=a.districtData,r=(a.selected,a.addressRange),d=a.selectedIndexArray,o=e.detail,s=o.column,c=void 0===s?0:s,l=o.value,_=void 0===l?0:l,u=[].concat(_toConsumableArray(d));switch(c){case 0:var h=n[t[_].national_code],g=i[h[0].national_code];u[0]=_,u[1]=0,u[2]=0,this.setData({addressRange:[t,h,g],selectedIndexArray:[].concat(_toConsumableArray(u))});break;case 1:var v=i[r[1][_].national_code];u[1]=_,u[2]=0,this.setData({addressRange:[t,r[1],v],selectedIndexArray:[].concat(_toConsumableArray(u))});break;case 2:u[2]=_,this.setData({selectedIndexArray:[].concat(_toConsumableArray(u))})}}}});